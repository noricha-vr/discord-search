services:
  bot:
    build:
      context: .
      dockerfile: docker/bot.Dockerfile
    env_file:
      - .env
    volumes:
      - ~/.config/gcloud:/root/.config/gcloud:ro
    restart: unless-stopped

  cron:
    build:
      context: .
      dockerfile: docker/cron.Dockerfile
    env_file:
      - .env
    volumes:
      - ~/.config/gcloud:/root/.config/gcloud:ro
      - sync-logs:/var/log
    restart: unless-stopped

  sync-job:
    build:
      context: .
      dockerfile: docker/jobs.Dockerfile
    env_file:
      - .env
    volumes:
      - ~/.config/gcloud:/root/.config/gcloud:ro
    profiles:
      - jobs
    command: ["python", "-m", "src.jobs.main"]

  sync-job-full:
    build:
      context: .
      dockerfile: docker/jobs.Dockerfile
    env_file:
      - .env
    volumes:
      - ~/.config/gcloud:/root/.config/gcloud:ro
    profiles:
      - jobs
    command: ["python", "-m", "src.jobs.main", "--full"]

volumes:
  sync-logs:
